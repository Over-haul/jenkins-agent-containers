version: 2.1

orbs:
  ivy-circleci-orb: nxtlytics/ivy-circleci-orb@0.0.4

workflows:
  version: 2
  build:
    jobs:
      - ivy-circleci-orb/build_docker:
          name: base
          working_directory: base/
          container_name: base
          simple_docker_tag: true
          context: ivy
          filters:
            branches:
              ignore:
                - /.*/
            tags:
              only: /^v.*/
      - ivy-circleci-orb/build_docker:
          name: datadog-agent
          requires:
            - base
          working_directory: datadog-agent/
          container_name: datadog-agent
          simple_docker_tag: true
          context: ivy
          filters:
            branches:
              ignore:
                - /.*/
            tags:
              only: /^v.*/
      - ivy-circleci-orb/build_docker:
          name: node12
          requires:
            - base
          working_directory: node12/
          container_name: node12
          simple_docker_tag: true
          context: ivy
          filters:
            branches:
              ignore:
                - /.*/
            tags:
              only: /^v.*/
      - ivy-circleci-orb/build_docker:
          name: python37
          requires:
            - base
          working_directory: python37/
          container_name: python37
          simple_docker_tag: true
          context: ivy
          filters:
            branches:
              ignore:
                - /.*/
            tags:
              only: /^v.*/
      - ivy-circleci-orb/build_docker:
          name: python38
          requires:
            - base
          working_directory: python38/
          container_name: python38
          simple_docker_tag: true
          context: ivy
          filters:
            branches:
              ignore:
                - /.*/
            tags:
              only: /^v.*/
      - ivy-circleci-orb/build_docker:
          name: python39
          requires:
            - base
          working_directory: python39/
          container_name: python39
          simple_docker_tag: true
          context: ivy
          filters:
            branches:
              ignore:
                - /.*/
            tags:
              only: /^v.*/
      - ivy-circleci-orb/build_docker:
          name: apache-airflow
          requires:
            - python37
          working_directory: apache-airflow/
          container_name: apache-airflow
          simple_docker_tag: true
          context: ivy
          filters:
            branches:
              ignore:
                - /.*/
            tags:
              only: /^v.*/
      - ivy-circleci-orb/build_docker:
          name: jupyterhub-singleuser-base
          requires:
            - python38
          working_directory: jupyterhub-singleuser-base/
          container_name: jupyterhub-singleuser-base
          simple_docker_tag: true
          context: ivy
          filters:
            branches:
              ignore:
                - /.*/
            tags:
              only: /^v.*/
